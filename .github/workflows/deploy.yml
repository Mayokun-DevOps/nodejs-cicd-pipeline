- name: Setup SSH Key and Known Hosts
  run: |
    mkdir -p ~/.ssh
    echo "${{ secrets.SSH_PRIVATE_KEY }}" > ~/.ssh/id_rsa
    chmod 600 ~/.ssh/id_rsa
    ssh-keyscan 192.168.56.14 >> ~/.ssh/known_hosts

- name: Copy files using scp
  run: |
    scp -i ~/.ssh/id_rsa -r ./app vagrant@192.168.56.14:/home/vagrant/app

- name: Restart App with Docker Compose
  run: |
    ssh -i ~/.ssh/id_rsa vagrant@192.168.56.14 "docker compose -f /home/vagrant/app/docker-compose.yml up -d --build"

